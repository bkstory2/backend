<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.vuebackend.mapper.BoardMapper">

    <!-- 단건 조회 -->
    <select id="selectBoard" resultType="Board">
        SELECT board_id as boardId, id, user_id as userId, title, body, file_nm as fileNm, created_at as createdAt, updated_at as updatedAt
        FROM board
        WHERE id = #{id}
    </select>

    <!-- 다건 조회 (board_id, LIKE 검색) -->
    <select id="selectList" resultType="Board">
        SELECT board_id as boardId, id, user_id as userId, title, body, file_nm as fileNm, created_at as createdAt, updated_at as updatedAt
        FROM board
        <where>
            <if test="board_id != null and board_id != ''">
                AND board_id = #{board_id}
            </if>
            <if test="userId != null and userId != ''">
                AND user_id LIKE CONCAT('%', #{userId}, '%')
            </if>
            <if test="title != null and title != ''">
                AND title LIKE CONCAT('%', #{title}, '%')
            </if>
            <if test="body != null and body != ''">
                AND body LIKE CONCAT('%', #{body}, '%')
            </if>
        </where>
        ORDER BY id DESC
    </select>

    <!-- 등록 -->
    <insert id="insertBoard" parameterType="Board" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO board (board_id, user_id, title, body, file_nm, created_at)
        VALUES (#{boardId}, #{userId}, #{title}, #{body}, #{fileNm}, NOW())
    </insert>

    <!-- 수정 -->
    <update id="updateBoard" parameterType="Board">
        UPDATE board
        <set>
            <if test="boardId != null">
                board_id = #{boardId},
            </if>
            <if test="userId != null">
                user_id = #{userId},
            </if>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="body != null">
                body = #{body},
            </if>
            <if test="fileNm != null">
                file_nm = #{fileNm},
            </if>
            updated_at = NOW(),
        </set>
        WHERE id = #{id}
    </update>

    <!-- 삭제 -->
    <delete id="deleteBoard">
        DELETE FROM board
        WHERE id = #{id}
    </delete>

    <!-- 파일명 NULL로 업데이트 -->
    <update id="updateFileNmToNull">
        UPDATE board
        SET file_nm = NULL, updated_at = NOW()
        WHERE id = #{id}
    </update>

</mapper>
